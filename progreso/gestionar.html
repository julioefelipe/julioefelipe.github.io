<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Meta de Progreso</title>
</head>
<body>
    <h1>Gestionar Meta</h1>

    <form id="progressForm">
        <label for="goal">Meta (Goal):</label>
        <input type="number" id="goal" name="goal" required>
        <br><br>

        <label for="current">Actual (Current):</label>
        <input type="number" id="current" name="current" required>
        <br><br>

        <button type="submit">Actualizar</button>
    </form>

    <h2>JSON generado:</h2>
    <pre id="jsonOutput">{}</pre>

    <h2>Status:</h2>
    <p id="status"></p>

    <script>
        const form = document.getElementById('progressForm');
        const jsonOutput = document.getElementById('jsonOutput');
        const statusOutput = document.getElementById('status');

        // Cambia esto por tu token personal de GitHub
        const githubToken = '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';

        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const goal = document.getElementById('goal').value;
            const current = document.getElementById('current').value;

            const progressData = {
                goal: parseInt(goal),
                current: parseInt(current)
            };

            // Mostrar el JSON generado
            jsonOutput.textContent = JSON.stringify(progressData, null, 2);

            // Actualiza progress.json usando la API de GitHub
            try {
                const response = await fetch('https://api.github.com/repos/julioefelipe/julioefelipe.github.io/contents/progreso/progress.json', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Actualización de la meta de progreso',
                        content: btoa(JSON.stringify(progressData, null, 2)),  // Convierte a Base64
                        sha: await getCurrentSha()  // Obtiene el SHA del archivo actual
                    })
                });

                if (response.ok) {
                    statusOutput.textContent = '¡Actualización exitosa!';
                } else {
                    statusOutput.textContent = 'Error en la actualización.';
                }
            } catch (error) {
                console.error('Error:', error);
                statusOutput.textContent = 'Error: ' + error.message;
            }
        });

        // Obtener el SHA del archivo actual para la actualización
        async function getCurrentSha() {
            const response = await fetch('https://api.github.com/repos/julioefelipe/julioefelipe.github.io/contents/progreso/progress.json');
            const data = await response.json();
            return data.sha;
        }
    </script>
</body>
</html>
